# Redis集群

## 准备知识

### RDB
- 把内存里的key-value写到磁盘文件里
- fork一个子进程来生成RDB文件
- RDB文件是二进制文件
- 在一定的时间段内执行一定数量的写操作，会触发BGRDB

### AOF
- 写操作记录到AOF文件里
- AOF是一个文本文件
- 先写缓存，然后同步到AOF文件里。同步策略有3种，比如其中一种是没隔1秒同步一次AOF文件
- AOF文件太大了之后会触发AOF重写。重写是根据当时的key-value来重新生成写操作，所以跟已经存在的AOF文件不相关
- AOF重写过程中的写操作记录在缓存，最后会追加到AOF文件里

## 主从复制
- 角色：主节点，从节点
- 从节点第一次连上主节点，发送命令PSYNC，主节点会执行全局复制：生成RDB文件，并发送给从节点（同时会把生成RDB文件过程中的写操作也发送给从节点）
- 同步完成之后，主节点会把写命令传播给从节点（命令传播）
- 从节点断线重连之后，发送命令PSYNC给主节点，主节点会执行部分复制：根据从节点的offset，从replication backlog里读取未同步的命令，发送给从节点
- replication backlog是一个固定大小的先进先出队列，每个位置存储了一个字节
- 从节点定时发送心跳检查给主节点，主节点检查到从节点的offset小于自己的offset，也会把未同步的命令补偿给从节点，整个过程与部分复制类似

## Sentinel

## 集群
