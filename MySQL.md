# MySQL

## 事务
事务的ACID属性
- A原子性：全部执行或者全部不执行
- C一致性：开始和完成时，数据保持一致性
- I隔离性：独立执行
- D持久性：数据的修改是永久性的

并发事务处理的问题
- 更新丢失：一个事务覆盖了另一个事务的数据更新
- 脏读：一个事务未提交数据更新，被另一个事务读取
- 不可重复读：重复读取的数据不同
- 幻读：一个事务重新查询，发现了另一个事务插入的数据

事务隔离级别（读数据一致性）：
- 未提交读：
- 已提交读：
- 可重复读：
- 可序列化：

## InnoDB锁机制
表锁
- 意向共享锁：事务给一个数据行加共享锁之前必须先取得该表的意向共享锁
- 意向排他锁：事务给一个数据行加排他锁之前必须先取得该表的意向排他锁

行锁
- 共享锁：允许事务去读一行，阻止其他事务获取该数据集的排他锁
- 排他锁：允许事务更新数据，阻止其他事务获取该数据集的共享读锁与排他写锁

INSERT,UPDATE,DELETE语句自动加排他锁。SELECT语句需要手动加锁：
- 共享锁：SELECT ... LOCK IN SHARE MODE
- 排他锁：SELECT ... FOR UPDATE

行锁通过给索引项加锁实现，而不是给记录加锁。只有通过索引检索才使用行锁，否则使用表锁。

### 间隙锁
使用范围条件检索，不存在的记录也会被加锁。使用相同条件检索也会给不存在的记录加锁。

### 特殊的锁
INSERT INTO ... SELECT, CREATE TABLE ... SELECT 语句会给源表加锁

